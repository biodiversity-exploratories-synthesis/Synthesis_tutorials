---
title: "model selection"
author: "N. Schenk"
date: "2023-02-01"
output: github_document
---

**Please note that this tutorial is in draft stage.**

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Model selection
This tutorial addresses the question of how a set of potential models can be reduced to a smaller set of final models, ideally to a single final value for each parameter estimate.

This tutorial excludes the assessment of bi- or multivariate associations between explanatory variables, which is an essential step before defining the set of potential models.

Further reading
- Highly recommended : Grace, J. B., and K. M. Irvine. 2020. Scientistâ€™s guide to developing explanatory statistical models using causal analysis principles. Ecology 101(4):e02962. 10.1002/ecy.2962

Outlook : using the `metafor` package.

[External source](https://sites.google.com/site/rforfishandwildlifegrads/home/mumin_usage_examples?pli=1) for additional reading. 

## Dependencies
```{r}
# install.packages("MuMIn")
library(MuMIn)
```


# model selection by hand
```{r}
library(AED)
data("biodiversity")

# na.fail : need to handle NA values BEFORE using the model 
#    because models which are fit on different subsets of rows are NOT comparable
mod1 <- lm(biomass ~ treatment + nutrient + concentration + mesocosm, data = Biodiversity, na.action = na.fail)
summary(mod1)

# fixed : define fixed variables that MUST stay in the model, e.g. the treatment variable of an experiment
#    note : keep this also if not significant!
dredge(mod1, beta = "none", fixed = c("treatment"))
```



# Model selection and averaging with the MuMIn package

Code partly generated by ChatGPT
```{r}
# Load an example data set with 10 variables
data(mtcars)

# Fit a full model with all 10 variables
full_model <- lm(mpg ~ ., data = mtcars, na.action = "na.fail")
# note : the na.action has to be set to "na.fail" in order to prevent an error in the dredge function

# Use the dredge() function to perform model selection
model_set <- dredge(full_model)

# Visualise the AIC values
plot(model_set$AICc)
abline(h = (min(model_set$AICc) + 2), col = "red")

# Extract the best models
# AIC is +- 2 points (https://www.cellulestat.cra.wallonie.be/wp-content/uploads/2016/12/Formation_Stats_3_3_Model_selection.pdf)
best_models <- model_set[model_set$AICc < min(model_set$AICc) + 2, ]

# Calculate the average model using the model.avg() function
average_model <- model.avg(best_models)
```
In this example, dredge() performs a stepwise model selection by testing all possible models (subsets of variables) in the full_model and returns a summary of the models with their respective Akaike Information Criterion (AIC) values. The which.min() function is then used to extract the models with the lowest AIC values (the best models), within a range of 2 AIC points. Finally, the model.avg() function is used to calculate the average model from the best models.


